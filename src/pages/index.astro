---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { readItems } from '@directus/sdk';
import { directus } from '../lib/directus';

// @ts-ignore
let directusPosts: any[] = [];

try {
  const response = await directus.request(readItems('posts'));
  directusPosts = response as any[];
} catch (error) {
  console.error("Directus Connection Error:", error);
}
---

<Layout title="Refined Lab | Блог">
  <Header />
  <main id="main-content" style="max-width: 800px; margin: 0 auto; padding: 2rem;">
    <section id="hero" style="margin-bottom: 3rem;">
      <h1 style="font-size: 3rem; font-weight: bold; margin-bottom: 1rem;">Refined Lab</h1>
      <p style="font-size: 1.25rem; opacity: 0.8;">Статьи из Directus:</p>
    </section>

    <section id="recent-posts">
      {directusPosts && directusPosts.length > 0 ? (
        <ul style="list-style: none; padding: 0;">
          {directusPosts.map((post) => (
            <li style="margin-bottom: 2.5rem;">
              <a href={`/posts/${post.id}`} style="color: #e11d48; text-decoration: underline;">
                <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">{post.title}</h3>
              </a>
              <p>{post.description}</p>
            </li>
          ))}
        </ul>
      ) : (
        <p>Статей пока нет.</p>
      )}
    </section>
  </main>
  <Footer />
</Layout>