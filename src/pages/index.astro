---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

// --- ПОДКЛЮЧЕНИЕ DIRECTUS ---
import { readItems } from '@directus/sdk';
import { directus } from '../lib/directus';

let directusPosts = [];
try {
  // Запрашиваем посты
  directusPosts = await directus.request(readItems('posts'));
} catch (error) {
  console.error("Directus Connection Error:", error);
}
---

<Layout>
  <Header />
  <main id="main-content" style="max-width: 800px; margin: 0 auto; padding: 2rem;">
    <section id="hero" style="margin-bottom: 3rem;">
      <h1 style="font-size: 3rem; font-weight: bold; margin-bottom: 1rem;">Refined Lab</h1>
      <p style="font-size: 1.25rem; opacity: 0.8;">
        Связь с Directus установлена. Ниже ваши реальные статьи:
      </p>
    </section>

    <hr style="border: 0; border-top: 1px dashed #666; margin-bottom: 3rem;" />

    <section id="recent-posts">
      <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 2rem;">Свежие статьи</h2>

      {directusPosts.length > 0 ? (
        <ul style="list-style: none; padding: 0;">
          {directusPosts.map((post) => (
            <li style="margin-bottom: 2.5rem;">
              <a
                href={`/posts/${post.id}`}
                style="color: var(--color-accent, #e11d48); text-decoration: underline; text-underline-offset: 4px;"
              >
                <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem; display: inline-block;">
                  {post.title}
                </h3>
              </a>
              <p style="opacity: 0.9; line-height: 1.6;">{post.description || "Нет описания"}</p>
            </li>
          ))}
        </ul>
      ) : (
        <p>Статьи не найдены. Проверьте, что в Directus есть опубликованные посты.</p>
      )}
    </section>
  </main>
  <Footer />
</Layout>

<style>
  /* Минимум стилей, чтобы ничего не ломалось */
  main {
    width: 100%;
  }
</style>